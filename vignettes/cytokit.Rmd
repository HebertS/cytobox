---
title: "cytokit examples"
date: "`r Sys.Date()`"
output:
    rmarkdown::html_vignette:
        toc: true
        toc_depth: 3
vignette: >
  %\VignetteIndexEntry{cytokit examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  collapse = TRUE,
  dev = "png",
  comment = "#>"
)
```

Load the package

```{r load}
library(cytokit)
```

# One-sample plots

## t-SNE/PCA

Basic t-SNE of a dataset (like `Seurat::TSNEPlot()`):

```{r tsne, fig.width = 6, fig.height = 4}

tsne(pbmc)
tsne(pbmc, label_repel = FALSE)

```

Plot a t-SNE coloured by mean marker expression

```{r tsneByMeanMarkerExpression, fig.width = 6, fig.height = 4, echo = TRUE, eval = TRUE}

tsneByMeanMarkerExpression(pbmc, c("IL32", "CD2"))

```


Plot a t-SNE coloured by percentiles marker expression

```{r tsneByPercentilesMarkerExpression, fig.width = 6, fig.height = 4}

tsneByPercentileMarkerExpression(pbmc, c("IL32", "CD2"))

# No labels
tsneByPercentileMarkerExpression(pbmc, c("IL32", "CD2"), label = FALSE)


```

Dashboard plot, which gives a bit more distrubtional information than tSNE:

```{r dashboard, fig.width = 8, fig.height = 4, warning = FALSE}

tsneByPercentileMarkerExpression(pbmc, c("IL32", "CD2"), label = TRUE, extra = TRUE, verbose = TRUE)

# This function is a shortcut for the above
dashboard(pbmc, c("IL32", "CD2"), title = "test genes")

```

Notes:

- This doesn't look good with few clusters; for a real sample with ~ 15 clusters, a good set of dimensions is width = 14, height = 8
- Known issue: the dashboard plots throw a big warning related to the unicode symbols.
Do warning = FALSE in the chunk options to not print it.




Feature plot, akin to `Seurat::FeaturePlot()`
```{r feature, fig.width = 4, fig.height = 4, warning = FALSE}

tsneByPercentileMarkerExpression(pbmc, c("IL32", "CD2"), label_repel = FALSE, palette = "redgrey", alpha = FALSE, point_size = 0.1, legend = FALSE)

# This function is a shortcut for the above, except by default it makes one plot
# per gene (set per_gene = FALSE like below to have one plot with the summary statistic)
feature(pbmc, c("IL32", "CD2"), per_gene = FALSE)

```


Feature plots for individual genes:


```{r feature_indiv, fig.width = 12, fig.height = 4}

feature(pbmc, c("IL32", "CD2", "MS4A1"), per_gene = TRUE)
feature(pbmc, c("IL32", "CD2", "MS4A1"), per_gene = TRUE, statistic = "mean")

```

## Violins

Violin plot for a set of genes (like `Seurat::VlnPlot()`)

```{r violin, fig.width = 5, fig.height = 3}

vln(pbmc, c("IL32", "MS4A1"), facet_by = "gene")

# Inverted, one plot per cluster (the default)
vln(pbmc, c("IL32", "MS4A1"), facet_by = "cluster")

```


Panel of tiny violin plots for a set of genes, as in Figure 5D in the drop-seq paper.
See docs for default ordering method.

```{r vlnPanel, fig.width = 7, fig.height = 2}

# Use the first 15 genes in the data
vlnGrid(pbmc, genes = head(rownames(pbmc@data), 15))

# Specify order
vlnGrid(pbmc, head(rownames(pbmc@data), 15), order = c(0, 3, 2, 1))

```





# Two-sample plots

Pariwise violin plot

```{r markerViolinPlot, fig.width = 6, fig.height = 4}

pairwiseVln(pbmc, markers_pbmc, pbmc, "PBMC1", "PBMC2")

```


Heatmap of minimum % overlap of gene markers between clusters from two different samples:
(here, comparing one dataset to itself)

```{r heatmapPercentMarkerOverlap, fig.width = 5, fig.height = 4}

heatmapPercentMarkerOverlap(markers_pbmc, markers_pbmc, s1_name = "PBMC", s2_name = "PBMC")

```


# Helper functions

Subset data by gene and cluster

```{r fetchData}

head(fetchData(pbmc, "IL32", c(1, 2)))
head(fetchData(pbmc, c("IL32", "MS4A1"), c(1, 2), return_cluster = TRUE, return_cell = TRUE))

```


